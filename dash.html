<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>BAKENEKO GAMES â€” Internal Dashboard</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#0a0c10;color:#e8e8f0;font-family:'Segoe UI',system-ui,sans-serif;padding:20px;max-width:900px;margin:0 auto}
    h1{font-size:1.1rem;color:#ffd700;margin-bottom:6px;letter-spacing:.05em}
    .ts{font-size:.72rem;color:rgba(232,232,240,.35);margin-bottom:24px;font-family:monospace}
    h2{font-size:.9rem;color:#ffd700;margin:24px 0 10px;border-bottom:1px solid rgba(255,215,0,.15);padding-bottom:6px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:8px}
    .card{background:rgba(255,255,255,.03);border:1px solid rgba(255,215,0,.12);border-radius:8px;padding:14px 10px;text-align:center}
    .card .l{font-size:.7rem;color:rgba(232,232,240,.45);letter-spacing:.06em;display:block;margin-bottom:4px}
    .card .v{font-family:monospace;font-size:1.3rem;color:#ffd700;letter-spacing:.03em}
    .card .v.ok{color:#4ade80}
    .card .v.err{color:#f87171}
    .card .sub{font-size:.65rem;color:rgba(232,232,240,.3);margin-top:3px;display:block}
    .rank-row{display:flex;gap:8px;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.82rem}
    .rank-row .pos{font-family:monospace;color:#ffd700;min-width:24px;text-align:right}
    .rank-row .nm{flex:1;color:rgba(232,232,240,.8)}
    .rank-row .sc{font-family:monospace;color:rgba(232,232,240,.6)}
    table.t{width:100%;border-collapse:collapse;font-size:.8rem;margin:8px 0}
    table.t th{text-align:left;padding:6px 8px;background:rgba(255,215,0,.06);color:#ffd700;font-size:.72rem;letter-spacing:.06em}
    table.t td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.04);color:rgba(232,232,240,.75)}
    #auth-wall{text-align:center;margin-top:30vh}
    #auth-wall p{color:rgba(232,232,240,.4);font-size:.85rem}
    a{color:#ffd700}
  </style>
</head>
<body>
  <div id="auth-wall"><p>ğŸ”’</p></div>
  <div id="dashboard" style="display:none">
    <h1>BAKENEKO GAMES â€” Internal Dashboard</h1>
    <div class="ts" id="dash-ts">â€”</div>

    <h2>ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒ</h2>
    <div class="grid">
      <div class="card"><span class="l">ãƒãƒ¼ã‚¿ãƒ«</span><span class="v" id="d-portal">â€”</span></div>
      <div class="card"><span class="l">ã‚²ãƒ¼ãƒ </span><span class="v" id="d-game">â€”</span></div>
      <div class="card"><span class="l">API</span><span class="v" id="d-api">â€”</span></div>
    </div>

    <h2>ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯</h2>
    <div class="grid">
      <div class="card"><span class="l">ç´¯è¨ˆPVï¼ˆåˆç®—ï¼‰</span><span class="v" id="d-total-pv">â€”</span></div>
      <div class="card"><span class="l">æœ¬æ—¥PVï¼ˆåˆç®—ï¼‰</span><span class="v" id="d-today-pv">â€”</span></div>
      <div class="card"><span class="l">ã‚²ãƒ¼ãƒ PV</span><span class="v" id="d-game-pv">â€”</span></div>
      <div class="card"><span class="l">ãƒãƒ¼ã‚¿ãƒ«PV</span><span class="v" id="d-portal-pv">â€”</span></div>
    </div>

    <h2>ã‚²ãƒ¼ãƒ æŒ‡æ¨™</h2>
    <div class="grid">
      <div class="card"><span class="l">ç´¯è¨ˆãƒ—ãƒ¬ã‚¤æ•°</span><span class="v" id="d-plays">â€”</span></div>
      <div class="card"><span class="l">ç´¯è¨ˆå¿œæ´</span><span class="v" id="d-support">â€”</span></div>
      <div class="card"><span class="l">æœ¬æ—¥ã®å¿œæ´</span><span class="v" id="d-today-support">â€”</span></div>
    </div>

    <h2>åºƒå‘Šãƒ»ãƒãƒŠãƒ¼</h2>
    <div class="grid">
      <div class="card"><span class="l">ãƒãƒŠãƒ¼ã‚¯ãƒªãƒƒã‚¯</span><span class="v" id="d-banner">â€”</span></div>
      <div class="card"><span class="l">åºƒå‘Šè¦–è´å®Œäº†</span><span class="v" id="d-rewards">â€”</span></div>
    </div>

    <h2>ä¸–ç•Œãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP 10</h2>
    <div id="d-ranking"></div>

    <h2>ã‚¤ãƒ³ãƒ•ãƒ©</h2>
    <table class="t">
      <tbody>
        <tr><td style="width:35%">ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°</td><td>Cloudflare Pages</td></tr>
        <tr><td>API</td><td>Cloudflare Workers</td></tr>
        <tr><td>DB</td><td>Cloudflare D1</td></tr>
        <tr><td>ãƒ‰ãƒ¡ã‚¤ãƒ³</td><td>bakenekocafe.studioï¼ˆCloudflare DNSï¼‰</td></tr>
        <tr><td>CDN / SSL</td><td>Cloudflareï¼ˆè‡ªå‹•è¨¼æ˜æ›¸ï¼‰</td></tr>
      </tbody>
    </table>

    <h2>è¨ˆæ¸¬ã‚½ãƒ¼ã‚¹</h2>
    <table class="t">
      <thead><tr><th>æŒ‡æ¨™</th><th>è‡ªå‰ D1</th><th>GA4</th></tr></thead>
      <tbody>
        <tr><td>PV</td><td>page_view</td><td>è‡ªå‹•</td></tr>
        <tr><td>ã‚²ãƒ¼ãƒ é–‹å§‹</td><td>game_start</td><td>game_start</td></tr>
        <tr><td>ãƒãƒŠãƒ¼ã‚¯ãƒªãƒƒã‚¯</td><td>banner_click</td><td>banner_click</td></tr>
        <tr><td>åºƒå‘Šå¿œæ´</td><td>supportç³»</td><td>ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ</td></tr>
        <tr><td>ãƒ¦ãƒ¼ã‚¶ãƒ¼å±æ€§</td><td>â€”</td><td>GA4ãƒ¬ãƒãƒ¼ãƒˆ</td></tr>
      </tbody>
    </table>
    <p style="font-size:.75rem;opacity:.35;margin-top:8px">
      GA4 è©³ç´°: <a href="https://analytics.google.com/" target="_blank">analytics.google.com</a>
    </p>
  </div>

  <script>
  (function(){
    var DASH_KEY = 'bakeneko-dash-2026';
    var params = new URLSearchParams(location.search);
    if (params.get('key') !== DASH_KEY) return;

    document.getElementById('auth-wall').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';

    var API = 'https://api.bakenekocafe.studio';
    function setText(id,v){ var el=document.getElementById(id); if(el) el.textContent=v; }
    function setCls(id,c){ var el=document.getElementById(id); if(el) el.className='v '+c; }

    function check(url){ return fetch(url,{method:'HEAD',mode:'cors'}).then(function(r){return r.ok}).catch(function(){return false}); }

    Promise.all([
      check('https://bakenekocafe.studio/').then(function(ok){ setText('d-portal',ok?'OK':'NG'); setCls('d-portal',ok?'ok':'err'); }),
      check('https://bakenekocafe.studio/game.html').then(function(ok){ setText('d-game',ok?'OK':'NG'); setCls('d-game',ok?'ok':'err'); }),
      Promise.all([
        fetch(API+'/api/public-stats?gameId=kohada').then(function(r){return r.json()}).catch(function(){return {}}),
        fetch(API+'/api/public-stats?gameId=portal').then(function(r){return r.json()}).catch(function(){return {}})
      ]).then(function(arr){
        var g=arr[0], p=arr[1];
        setText('d-api','OK'); setCls('d-api','ok');
        setText('d-plays', ((g.totalPlays||0)).toLocaleString());
        setText('d-support', ((g.totalSupportCount||0)).toLocaleString());
        setText('d-today-support', ((g.todaySupportCount||0)).toLocaleString());
        var totalPv=(g.totalPv||0)+(p.totalPv||0);
        var todayPv=(g.todayPv||0)+(p.todayPv||0);
        setText('d-total-pv', totalPv.toLocaleString());
        setText('d-today-pv', todayPv.toLocaleString());
        setText('d-game-pv', ((g.totalPv||0)).toLocaleString());
        setText('d-portal-pv', ((p.totalPv||0)).toLocaleString());
        setText('d-banner', ((g.totalBannerClicks||0)+(p.totalBannerClicks||0)).toLocaleString());
        setText('d-rewards', ((g.totalRewards||0)).toLocaleString());
      }).catch(function(){ setText('d-api','NG'); setCls('d-api','err'); })
    ]).then(function(){
      var n=new Date();
      setText('dash-ts', n.getFullYear()+'-'+String(n.getMonth()+1).padStart(2,'0')+'-'+String(n.getDate()).padStart(2,'0')+' '+String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0')+':'+String(n.getSeconds()).padStart(2,'0'));
    });

    fetch(API+'/api/ranking/leaderboard?gameId=kohada&limit=10').then(function(r){return r.json()}).then(function(d){
      var w=document.getElementById('d-ranking'); if(!w) return;
      var h='';
      (d.entries||[]).forEach(function(e){
        var dt='';
        if(e.submitted_at){ var dd=new Date(e.submitted_at); dt=' <span style="font-size:.7rem;opacity:.35">'+(dd.getMonth()+1)+'/'+dd.getDate()+'</span>'; }
        h+='<div class="rank-row"><span class="pos">#'+e.rank+'</span><span class="nm">'+esc(e.nickname||'åç„¡ã—')+'</span><span class="sc">'+Number(e.score).toLocaleString()+'m'+dt+'</span></div>';
      });
      w.innerHTML=h||'<p style="opacity:.3">ãƒ‡ãƒ¼ã‚¿ãªã—</p>';
    }).catch(function(){});

    function esc(s){ var d=document.createElement('div'); d.textContent=s; return d.innerHTML; }
  })();
  </script>
</body>
</html>
